{% extends "::base.html.twig" %}

{% block body  %}
    {{parent()}}

    <div class="content-wrapper">
        <!-- Content Header (Page header) -->
        <section class="content-header">
            <h1>
                CGM (CADASTRO GERAL MUNICIPAL)
                {#<small>it all starts here</small>#}
            </h1>     
        </section>

        <!-- Main content -->
        <section class="content">
            {% for label, flashes in app.session.flashbag.all %}
                {% for flash in flashes %}
                    <div class="alert alert-{{ label }} alert-dismissable">
                        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
                        <h4>Alerta!</h4>
                        {{ flash }}
                    </div>
                {% endfor %}
            {% endfor %}
            <!-- Default box -->
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">CGM - Pessoa Física</h3>
                    {#<div class="box-tools pull-right">
                      <button class="btn btn-box-tool" data-widget="collapse" data-toggle="tooltip" title="Collapse"><i class="fa fa-minus"></i></button>
                    </div>#}
                </div>
                {{ form_start(form, { 'style': 'horizontal', 'id' : 'formInstituicao'}) }}
                <div class="box-body">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li role="presentation"class="active">
                                <a href="#dadosPessoais"aria-controls="dadosPessoais"role="tab"data-toggle="tab">
                                    Informações básicas</a >
                            </li >
                            <li role="presentation">
                                <a href="#dadosComplementares"aria-controls="dadosComplementares"role="tab"data-toggle="tab">
                                    Documentação</a >
                            </li >
                            <li role="presentation">
                                <a href="#endereco"aria-controls="endereco"role="tab"data-toggle="tab">
                                    Endereço</a >
                            </li >
                        </ul >
                        <div class="tab-content">
                            <div class="tab-pane fade in active"id="dadosPessoais">
                                <br />
                                {{ form_row(form.nome) }}
                                {{ form_row(form.sexoSexo) }}
                                {{ form_row(form.dataNascimento) }}
                                {{ form_row(form.dataFalecimento) }}
                                {{ form_row(form.nacionalidade) }}
                                {{ form_row(form.naturalidade) }}
                                {{ form_row(form.inscricaoEstadual) }}
                                {{ form_row(form.CGMMunicipio) }}
                                {{ form_row(form.telefones) }}
                                {{ form_row(form.email) }}
                                {{ form_row(form.foto) }}
                            </div>    
                            <div class="tab-pane fade"id="dadosComplementares">
                                <br />
                                {{ form_row(form.pai) }}
                                {{ form_row(form.mae) }}
                                {{ form_row(form.estadoCivil) }}
                                {{ form_row(form.escolaridade) }}
                                {{ form_row(form.CpfCnpj) }}
                                {{ form_row(form.rg) }}
                                {{ form_row(form.orgaoEmissor) }}
                                {{ form_row(form.dataExpedicao) }}
                                {{ form_row(form.numCNH) }}
                                {{ form_row(form.vencimentoCNH) }}
                                {{ form_row(form.ctgCNH) }}
                            </div>
                            <div class="tab-pane fade"  id="endereco">
                                <br />
                                {{ form_row(form.endereco.logradouro) }}
                                {{ form_row(form.endereco.numero) }}
                                {{ form_row(form.endereco.comp) }}
                                {{ form_row(form.endereco.cep) }}
                                {{ form_row(form.endereco.bairro) }}
                                {{ form_row(form.endereco.cidade) }}
                            </div>
                        </div>
                    </div>
                </div><!-- /.box-body -->

                <div class="box-footer">
                    {{ form_row(form.actions) }}
                </div><!-- /.box-footer-->
                {{ form_end(form) }}
            </div><!-- /.box -->

        </section><!-- /.content -->
    </div><!-- /.content-wrapper -->

    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 1.0
        </div>
        <strong>Copyright &copy; <a href="">Serbinário</a>.</strong> Todos os direitos reservados.
    </footer>
{% endblock %}
{% block javascripts %}
    {{parent()}}
    <script type="text/javascript" src="{{asset('js/validacoes/validationForm_cgm.js')}}"></script>
    <script type="text/javascript">
        $(document).on('click', '#escolabundle_cgm_actions_cancel', function () {
            window.location.href = '{{path('consultaCGM')}}';
        });
        
        $(document).on('blur', '#escolabundle_cgm_CpfCnpj', function () {
            var Objcpf = $(this).val();
            var msg = "";
            var retorno = ValidarCPF(Objcpf);
            
            if(retorno === false) {
                $(this).parent().parent().addClass("has-error");
                msg += "<span id='helpBlock2' style='font-size: 11px;' class='help-block'>O CPF informado não é válido</span>";
                $("#helpBlock2").remove();
                $(this).parent().append(msg);
                $('#escolabundle_cgm_actions_save').attr('disabled', true);
            } else {
                $("#helpBlock2").remove();
                $('#escolabundle_cgm_actions_save').attr('disabled', false);
            }
        });
        
        function ValidarCPF(Objcpf){
                var cpf = Objcpf;
                exp = /\.|\-/g;
                cpf = cpf.toString().replace( exp, "" ); 
                var digitoDigitado = eval(cpf.charAt(9)+cpf.charAt(10));
                var soma1=0, soma2=0;
                var vlr =11;

                for(i=0;i<9;i++){
                        soma1+=eval(cpf.charAt(i)*(vlr-1));
                        soma2+=eval(cpf.charAt(i)*vlr);
                        vlr--;
                }       
                soma1 = (((soma1*10)%11)==10 ? 0:((soma1*10)%11));
                soma2=(((soma2+(2*soma1))*10)%11);

                var digitoGerado=(soma1*10)+soma2;
                if(digitoGerado!=digitoDigitado)
                        return false;   
            }
    </script>
{% endblock %}
